---
title: "Supplementary_Table1"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(countrycode)
library(reshape2)
library(stringr)
library(data.table)
library(zoo)
library(here)
```

# Data

```{r}
trade<-read.csv(here("output_data/Trade_displacement.csv"))
fish<-read.csv(here("output_data/Fish_displacement.csv"))
me_dat<-read.csv(here("output_data/Management_data_clean.csv")) %>% 
  mutate()
```

# Subset trade and fisheries data to average between 2011-2015

```{r}
sub_trade<-trade %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015)) %>% 
  dplyr::select(-X, -prop_unequal) %>% 
  group_by(Import_ISO3) %>% 
  summarise_all(mean, na.rm = T)

```

```{r}
sub_fish<-fish %>% 
  filter(Year %in% c(2011,2012,2013,2014,2015)) %>% 
  dplyr::select(-X, -prop_disp, -prop_unequal_disp) %>% 
  group_by(Fishing_ISO3) %>% 
  summarise_all(mean, na.rm = T)
```

# Join all together

```{r}
all_dat<-full_join(sub_trade, sub_fish, by = c("Year", "Import_ISO3" = "Fishing_ISO3")) %>% 
  rename(Country = Import_ISO3) %>% 
  full_join(., me_dat, by = c("Country" = "Export_ISO3")) %>% 
  mutate(ME_score = ifelse(Country == "HighSeas", 49,ME_score)) %>% 
  filter(!is.na(ME_score) == T) %>% 
  dplyr::select(-X, -Year)
```

Need to double check trade - way off from current analysis

```{r}
final<-all_dat %>% 
  mutate(Country.Name = countrycode(Country, "iso3c", "country.name"),
         Country.Name = ifelse(Country == "ANT", "Netherlands Antilles",
                               ifelse(Country == "SCG", "Serbia and Montenegro",
                                      ifelse(Country == "HighSeas", "High seas", Country.Name)))) %>% 
  rename(ISO3 = Country) %>% 
  dplyr::select(Country.Name, ISO3, ME_score, imports, disp_fished, unequal_imports, unequal_fish, unequal_fish_eez, unequal_fish_hs, unequal_fishing_in_waters)
```
```{r}
write.csv(final, here("output_data/Supplementary_Table1.csv"))
```

